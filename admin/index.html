<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin — Food Spot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>body{font-family:Inter,ui-sans-serif,system-ui;background:#0b1220;color:#e6eef8}</style>
</head>
<body class="min-h-screen p-6">
  <div class="max-w-4xl mx-auto">
    <div id="top-bar" class="flex items-center justify-between mb-4">
      <a id="back-to-start" href="../index.html" class="px-3 py-2 bg-gray-700 rounded text-white hover:bg-gray-600"><i class="fas fa-arrow-left mr-2"></i>Back</a>
      <div class="flex gap-2">
        <button id="export-config-btn" class="px-3 py-2 bg-blue-600 rounded text-white hidden"><i class="fas fa-file-export mr-2"></i>Export Config</button>
        <button id="reset-setup-btn" class="px-3 py-2 bg-red-600 rounded text-white hidden"><i class="fas fa-undo mr-2"></i>Reset Setup</button>
      </div>
    </div>

    <h1 id="page-heading" class="text-3xl font-bold text-purple-300 mb-6 text-center">Admin Dashboard</h1>

    <!-- SETUP FORM (shown if no config) -->
    <div id="setup-container" class="bg-gray-800 p-6 rounded-lg shadow mb-6 hidden">
      <h2 class="text-xl font-semibold mb-3">First-time setup</h2>
      <p class="text-gray-300 mb-4">Create your admin PIN (exactly 15 characters) and add 2–10 products that will populate your kiosk.</p>

      <div class="mb-4">
        <label class="block text-sm text-gray-300 mb-1">Create 15-character Admin PIN</label>
        <input id="setup-pin" maxlength="15" placeholder="Enter 15 characters" class="w-full p-3 rounded bg-gray-700 placeholder-gray-400 text-white" />
        <p id="pin-hint" class="text-xs text-gray-400 mt-2">Use letters and numbers. Keep this safe.</p>
      </div>

      <div>
        <h3 class="text-lg font-medium text-gray-200 mb-2">Products (2–10)</h3>
        <div id="products-list" class="space-y-3"></div>
        <div class="flex gap-2 mt-3">
          <button id="add-product-btn" class="px-4 py-2 bg-indigo-600 rounded text-white">Add product</button>
          <button id="auto-fill-btn" class="px-4 py-2 bg-gray-600 rounded text-white">Auto-fill sample</button>
        </div>
        <p id="product-error" class="text-red-400 mt-2 hidden">Add at least 2 products (max 10).</p>
      </div>

      <div class="mt-6 text-right">
        <button id="finish-setup-btn" class="px-6 py-3 bg-green-600 rounded text-white font-bold">Finish setup</button>
      </div>
    </div>

    <!-- LOGIN SECTION (shown after setup saved) -->
    <div id="login-container" class="bg-gray-800 p-6 rounded-lg shadow mb-6 hidden">
      <p class="text-gray-300 mb-4">Enter your admin PIN to access the dashboard:</p>
      <input id="admin-pin-input" type="password" placeholder="Enter PIN" class="w-full p-3 rounded bg-gray-700 text-white" />
      <div class="mt-4 text-right">
        <button id="admin-login-btn" class="px-4 py-2 bg-purple-600 rounded text-white font-semibold">Login</button>
      </div>
      <p id="login-msg" class="text-red-400 mt-3 hidden">Incorrect PIN.</p>
    </div>

    <!-- DASHBOARD (after login) -->
    <div id="dashboard-container" class="hidden">
      <h2 class="text-2xl font-semibold text-green-300 mb-4">Order Status Overview</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div class="bg-gray-700 p-4 rounded admin-column">
          <h3 class="font-semibold text-gray-200 mb-2">Pending Payments</h3>
          <div id="new-orders-list" class="space-y-2 max-h-64 overflow-auto">
            <p class="text-gray-400">No new orders.</p>
          </div>
        </div>

        <div class="bg-gray-700 p-4 rounded admin-column">
          <h3 class="font-semibold text-gray-200 mb-2">In Progress</h3>
          <div id="in-progress-orders-list" class="space-y-2 max-h-64 overflow-auto">
            <p class="text-gray-400">No orders in progress.</p>
          </div>
        </div>

        <div class="bg-gray-700 p-4 rounded admin-column">
          <h3 class="font-semibold text-gray-200 mb-2">Completed</h3>
          <div id="completed-orders-list" class="space-y-2 max-h-64 overflow-auto">
            <p class="text-gray-400">No completed orders.</p>
          </div>
        </div>
      </div>

      <div class="flex gap-2">
        <button id="save-orders-btn" class="px-4 py-2 bg-blue-600 rounded text-white"><i class="fas fa-save mr-2"></i>Save Completed (copy)</button>
        <button id="clear-orders-btn" class="px-4 py-2 bg-red-600 rounded text-white"><i class="fas fa-trash mr-2"></i>Clear All Orders</button>
      </div>

      <hr class="my-6 border-gray-700" />

      <div class="bg-gray-800 p-4 rounded">
        <h3 class="text-lg font-medium text-gray-200 mb-3">Store Settings</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="text-sm text-gray-300">Store name</label>
            <input id="store-name" class="w-full p-2 rounded bg-gray-700 text-white" />
          </div>
          <div>
            <label class="text-sm text-gray-300">Public link (optional)</label>
            <input id="store-url" class="w-full p-2 rounded bg-gray-700 text-white" />
          </div>
        </div>
        <div class="mt-4 text-right">
          <button id="save-settings-btn" class="px-4 py-2 bg-indigo-600 rounded text-white">Save settings</button>
        </div>
      </div>
    </div>
  </div>

<script>
/*
  Data model stored in localStorage under key: foodSpotConfig
  {
    adminPin: "15chars",
    storeName: "My Shop",
    products: [ {id,name,description,price,imageUrl} ... ],
    orders: [ ... ]  // optional, used by admin to manage runtime orders
  }
*/

const STORAGE_KEY = 'foodSpotConfig_v1';

function readConfig() {
  try {
    return JSON.parse(localStorage.getItem(STORAGE_KEY));
  } catch(e) {
    return null;
  }
}
function saveConfig(cfg) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(cfg));
}

function downloadJSON(obj, filename='config.json') {
  const blob = new Blob([JSON.stringify(obj, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename; document.body.appendChild(a); a.click();
  setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 1000);
}

/* UI elements */
const setupContainer = document.getElementById('setup-container');
const productsList = document.getElementById('products-list');
const addProductBtn = document.getElementById('add-product-btn');
const finishSetupBtn = document.getElementById('finish-setup-btn');
const autoFillBtn = document.getElementById('auto-fill-btn');
const productError = document.getElementById('product-error');

const loginContainer = document.getElementById('login-container');
const adminPinInput = document.getElementById('admin-pin-input');
const adminLoginBtn = document.getElementById('admin-login-btn');
const loginMsg = document.getElementById('login-msg');

const dashboardContainer = document.getElementById('dashboard-container');
const exportBtn = document.getElementById('export-config-btn');
const resetBtn = document.getElementById('reset-setup-btn');

const pageHeading = document.getElementById('page-heading');

let workingProducts = [];

function createProductRow(product = {}) {
  const id = product.id || ('p' + Math.random().toString(36).slice(2,9));
  const wrapper = document.createElement('div');
  wrapper.className = 'bg-gray-700 p-3 rounded flex gap-3 items-start';
  wrapper.dataset.pid = id;
  wrapper.innerHTML = `
    <div class="flex-1">
      <input placeholder="Name" class="w-full p-2 mb-2 rounded bg-gray-600 text-white product-name" value="${product.name || ''}"/>
      <input placeholder="Price (USD)" class="w-full p-2 mb-2 rounded bg-gray-600 text-white product-price" value="${product.price !== undefined ? product.price : ''}"/>
      <input placeholder="Image URL" class="w-full p-2 mb-2 rounded bg-gray-600 text-white product-image" value="${product.imageUrl || ''}"/>
      <textarea placeholder="Short description" class="w-full p-2 rounded bg-gray-600 text-white product-desc">${product.description || ''}</textarea>
    </div>
    <div class="flex flex-col gap-2">
      <button class="remove-prod px-3 py-2 bg-red-600 rounded text-white">Remove</button>
    </div>
  `;
  wrapper.querySelector('.remove-prod').addEventListener('click', () => {
    wrapper.remove();
  });
  return wrapper;
}

function renderProductInputs() {
  productsList.innerHTML = '';
  workingProducts.forEach(p => {
    productsList.appendChild(createProductRow(p));
  });
}

function gatherProductsFromUI() {
  const nodes = Array.from(productsList.querySelectorAll('[data-pid]'));
  const out = nodes.map(n => {
    const name = n.querySelector('.product-name').value.trim();
    const price = parseFloat(n.querySelector('.product-price').value || '0');
    const imageUrl = n.querySelector('.product-image').value.trim();
    const description = n.querySelector('.product-desc').value.trim();
    return {
      id: n.dataset.pid,
      name, price, imageUrl, description
    };
  }).filter(p => p.name && !isNaN(p.price));
  return out;
}

/* Setup logic */
function showSetup() {
  setupContainer.classList.remove('hidden');
  loginContainer.classList.add('hidden');
  dashboardContainer.classList.add('hidden');
  exportBtn.classList.add('hidden');
  resetBtn.classList.add('hidden');
}

function showLogin() {
  setupContainer.classList.add('hidden');
  loginContainer.classList.remove('hidden');
  dashboardContainer.classList.add('hidden');
  exportBtn.classList.remove('hidden');
  resetBtn.classList.remove('hidden');
}

function showDashboard(cfg) {
  setupContainer.classList.add('hidden');
  loginContainer.classList.add('hidden');
  dashboardContainer.classList.remove('hidden');
  exportBtn.classList.remove('hidden');
  resetBtn.classList.remove('hidden');
  // apply store name if exists
  if (cfg.storeName) {
    pageHeading.textContent = cfg.storeName + ' — Admin Dashboard';
    document.getElementById('store-name').value = cfg.storeName;
  } else {
    pageHeading.textContent = 'Admin Dashboard';
  }
  document.getElementById('store-url').value = cfg.storeUrl || '';
  // render orders if present
  renderOrders(cfg.orders || []);
}

/* Orders UI (simple) */
function renderOrders(orders) {
  const newList = document.getElementById('new-orders-list');
  const inProg = document.getElementById('in-progress-orders-list');
  const done = document.getElementById('completed-orders-list');
  newList.innerHTML = ''; inProg.innerHTML = ''; done.innerHTML = '';

  if (!orders || orders.length === 0) {
    newList.innerHTML = '<p class="text-gray-400">No new orders.</p>';
    inProg.innerHTML = '<p class="text-gray-400">No orders in progress.</p>';
    done.innerHTML = '<p class="text-gray-400">No completed orders.</p>';
    return;
  }
  orders.forEach(order => {
    const div = document.createElement('div');
    div.className = 'bg-gray-600 p-3 rounded mb-2';
    div.innerHTML = `<div class="text-sm text-gray-300 mb-1">ID: ${order.id}</div>
      <div class="text-sm text-gray-200 font-semibold">Total: $${(order.total||0).toFixed(2)}</div>
      <div class="text-xs text-gray-400 mt-2">${(order.items||[]).map(i=>i.name + ' x' + i.quantity).join(', ')}</div>
    `;
    if (order.status === 'new') newList.appendChild(div);
    else if (order.status === 'in-progress') inProg.appendChild(div);
    else done.appendChild(div);
  });
}

/* Start: check config */
const existingCfg = readConfig();
if (!existingCfg) {
  // no setup yet -> show setup form
  showSetup();
  // start with two empty product rows
  workingProducts = [{},{},]; // 2 default
  renderProductInputs();
} else {
  // setup exists -> show login
  showLogin();
}

/* Events */
addProductBtn.addEventListener('click', () => {
  if (productsList.querySelectorAll('[data-pid]').length >= 10) return;
  const row = createProductRow({});
  productsList.appendChild(row);
});
autoFillBtn.addEventListener('click', () => {
  workingProducts = [
    { name: 'Classic Burger', price: 9.99, imageUrl: 'https://placehold.co/400x200/4a5568/a0aec0?text=Burger', description: 'Juicy 100% beef patty' },
    { name: 'Crispy Fries', price: 3.49, imageUrl: 'https://placehold.co/400x200/4a5568/a0aec0?text=Fries', description: 'Golden fries' }
  ];
  renderProductInputs();
});

finishSetupBtn.addEventListener('click', () => {
  const pin = document.getElementById('setup-pin').value.trim();
  if (pin.length !== 15) {
    alert('Admin PIN must be exactly 15 characters.');
    return;
  }
  const products = gatherProductsFromUI();
  if (products.length < 2) {
    productError.classList.remove('hidden');
    return;
  }
  productError.classList.add('hidden');

  const cfg = {
    adminPin: pin,
    storeName: 'My Food Spot',
    storeUrl: '',
    products,
    orders: []
  };
  saveConfig(cfg);
  alert('Setup complete. You will be taken to login.');
  showLogin();
});

adminLoginBtn.addEventListener('click', () => {
  const cfg = readConfig();
  if (!cfg) {
    alert('No setup found. Please complete setup.');
    showSetup();
    return;
  }
  const attempt = adminPinInput.value.trim();
  if (attempt === cfg.adminPin) {
    loginMsg.classList.add('hidden');
    showDashboard(cfg);
  } else {
    loginMsg.classList.remove('hidden');
  }
});

exportBtn.addEventListener('click', () => {
  const cfg = readConfig();
  if (!cfg) { alert('No config found'); return; }
  downloadJSON(cfg, 'foodspot-config.json');
});

resetBtn.addEventListener('click', () => {
  if (!confirm('Resetting will remove the saved configuration on this site. Continue?')) return;
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
});

/* Save settings (store name / url) */
document.getElementById('save-settings-btn').addEventListener('click', () => {
  const cfg = readConfig();
  if (!cfg) return alert('No config.');
  cfg.storeName = document.getElementById('store-name').value.trim();
  cfg.storeUrl = document.getElementById('store-url').value.trim();
  saveConfig(cfg);
  alert('Settings saved.');
  pageHeading.textContent = cfg.storeName ? cfg.storeName + ' — Admin Dashboard' : 'Admin Dashboard';
});

/* Clear orders */
document.getElementById('clear-orders-btn').addEventListener('click', () => {
  if (!confirm('Clear all orders?')) return;
  const cfg = readConfig();
  if (!cfg) return;
  cfg.orders = [];
  saveConfig(cfg);
  renderOrders([]);
});

/* Save completed orders to clipboard (copy) */
document.getElementById('save-orders-btn').addEventListener('click', () => {
  const cfg = readConfig();
  if (!cfg) return alert('No data.');
  const completed = (cfg.orders || []).filter(o => o.status === 'completed');
  if (completed.length === 0) return alert('No completed orders.');
  navigator.clipboard.writeText(JSON.stringify(completed,null,2)).then(()=> alert('Copied to clipboard.'));
});

</script>
</body>
</html>
            top: 1rem;
            left: 1rem;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            background-color: #dc2626; /* Red-600 */
            color: white;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: background-color 0.2s ease-in-out;
        }
        .admin-btn:hover {
            background-color: #b91c1c; /* Red-700 */
        }
        .back-to-start-kiosk-btn {
            position: absolute;
            top: 1rem;
            left: 1rem;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            background-color: #4a5568; /* Gray-700 */
            color: white;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: background-color 0.2s ease-in-out;
            z-index: 10; /* Ensure it's above other elements if needed */
        }
        .back-to-start-kiosk-btn:hover {
            background-color: #2d3748; /* Gray-800 */
        }
        /* Admin Dashboard Column Styling */
        .admin-column {
            background-color: #2d3748;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .admin-column h3 {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #cbd5e0;
            border-bottom: 1px solid #4a5568;
            padding-bottom: 0.75rem;
            margin-bottom: 1rem;
        }
        .admin-order-card {
            background-color: #4a5568;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .admin-order-card .order-items-list {
            list-style: none;
            padding-left: 0;
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: #a0aec0;
        }
        .admin-order-card .order-items-list li {
            margin-bottom: 0.25rem;
        }
        .admin-order-card .status-buttons button {
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            border-radius: 0.375rem;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        .admin-order-card .status-buttons .btn-in-progress {
            background-color: #f6ad55; /* Orange */
            color: #2d3748;
        }
        .admin-order-card .status-buttons .btn-in-progress:hover {
            background-color: #ed8936;
        }
        .admin-order-card .status-buttons .btn-completed {
            background-color: #48bb78; /* Green */
            color: #2d3748;
        }
        .admin-order-card .status-buttons .btn-completed:hover {
            background-color: #38a169;
        }
        .admin-order-card .status-buttons .btn-revert {
            background-color: #a0aec0; /* Gray */
            color: #2d3748;
        }
        .admin-order-card .status-buttons .btn-revert:hover {
            background-color: #718096;
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 100; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0, 0, 0, 0.7); /* Black w/ opacity */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #2d3748;
            margin: auto;
            padding: 2.5rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            position: relative;
        }
    </style>
</head>
<body class="bg-gray-900">

    <div id="admin-panel-page" class="flex-1 flex flex-col p-4 min-h-screen">
        <div class="container bg-gray-800 p-8 rounded-2xl shadow-2xl w-full max-w-4xl mx-auto">
            <!-- Back to Kiosk link, now dynamic -->
            <a id="back-to-kiosk-btn" href="#" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors mb-6 inline-block">
                <i class="fas fa-arrow-left mr-2"></i> Back to Kiosk
            </a>
            <!-- The title is now dynamic, displaying the customer's name -->
            <h1 id="admin-page-title" class="text-4xl font-extrabold text-purple-400 mb-6 text-center"></h1>
            
            <!-- Admin Login -->
            <div id="admin-login-section" class="text-center mb-8">
                <p class="text-gray-300 text-lg mb-4">Enter PIN to access the Admin Dashboard:</p>
                <input type="password" id="admin-pin-input" class="w-full max-w-xs p-3 rounded-lg bg-gray-700 border border-gray-600 text-white text-center focus:outline-none focus:ring-2 focus:ring-purple-500 mb-4" placeholder="15-digit PIN">
                <button id="admin-login-submit-btn" class="px-6 py-3 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition-colors">
                    Login
                </button>
                <p id="admin-login-message" class="text-red-400 mt-4 hidden">Incorrect PIN. Please try again.</p>
            </div>

            <!-- Admin Dashboard Content (Hidden until logged in) -->
            <div id="admin-dashboard-content" class="hidden">
                <h2 class="text-3xl font-bold text-green-400 mb-4">Order Status Overview</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!--Pending Payments-->
                    <div class="admin-column">
                        <h3> Pending Payments </h3>
                        <div id="new-orders-list-admin" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                            <p class="text-gray-500 text-center text-sm" id="no-new-orders">No new orders.</p>
                        </div>
                    </div>
                    <!-- Orders In Progress -->
                    <div class="admin-column">
                        <h3>Orders In Progress</h3>
                        <div id="in-progress-orders-list-admin" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                            <p class="text-gray-500 text-center text-sm" id="no-in-progress-orders">No orders in progress.</p>
                        </div>
                    </div>
                    <!-- Completed/Delivered Orders -->
                    <div class="admin-column">
                        <h3>Completed/Delivered Orders</h3>
                        <div id="completed-orders-list-admin" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                            <p class="text-gray-500 text-center text-sm" id="no-completed-orders">No completed orders.</p>
                        </div>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row justify-between gap-4 mt-6">
                    <button id="clear-orders-btn" class="w-full sm:w-1/2 py-3 bg-red-600 text-white font-bold rounded-lg shadow-md hover:bg-red-700 transition-colors">
                        <i class="fas fa-trash-alt mr-2"></i> Clear All Orders
                    </button>
                    <button id="save-completed-orders-btn" class="w-full sm:w-1/2 py-3 bg-blue-400 text-white font-bold rounded-lg shadow-md hover:bg-blue-500 transition-colors">
                        <i class="fas fa-save mr-2"></i> Save Completed Orders To Clipboard
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="confirmation-modal" class="modal hidden">
        <div class="modal-content">
            <h3 class="text-2xl font-bold text-red-400 mb-4 text-center">Confirm Action</h3>
            <p id="confirmation-message" class="text-gray-300 text-lg mb-6 text-center">Are you sure you want to clear all orders? This action cannot be undone.</p>
            <div class="flex justify-center space-x-4">
                <button id="confirm-yes-btn" class="px-6 py-3 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition-colors">Yes, Clear All</button>
                <button id="confirm-no-btn" class="px-6 py-3 bg-gray-600 text-white font-bold rounded-lg hover:bg-gray-700 transition-colors">Cancel</button>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Dynamic Configuration ---
            // The config object is now available as `window.config`
            const customerName = window.config.customerName;
            const siteBaseUrl = window.config.siteBaseUrl;

            // Set the dynamic page title and H1 header
            document.getElementById('page-title').textContent = `${customerName} Admin Dashboard`;
            document.getElementById('admin-page-title').textContent = `${customerName} Admin Dashboard`;

            // Set the dynamic link for the "Back to Kiosk" button
            document.getElementById('back-to-kiosk-btn').href = siteBaseUrl;

            // --- DOM Elements ---
            const adminPinInput = document.getElementById('admin-pin-input');
            const adminLoginSubmitBtn = document.getElementById('admin-login-submit-btn');
            const adminLoginMessage = document.getElementById('admin-login-message');
            const adminDashboardContent = document.getElementById('admin-dashboard-content');
            
            const newOrdersListAdmin = document.getElementById('new-orders-list-admin');
            const inProgressOrdersListAdmin = document.getElementById('in-progress-orders-list-admin');
            const completedOrdersListAdmin = document.getElementById('completed-orders-list-admin');
            const noNewOrdersMessage = document.getElementById('no-new-orders');
            const noInProgressOrdersMessage = document.getElementById('no-in-progress-orders');
            const noCompletedOrdersMessage = document.getElementById('no-completed-orders');

            const clearOrdersBtn = document.getElementById('clear-orders-btn');
            const saveCompletedOrdersBtn = document.getElementById('save-completed-orders-btn');
            
            const confirmationModal = document.getElementById('confirmation-modal');
            const confirmYesBtn = document.getElementById('confirm-yes-btn');
            const confirmNoBtn = document.getElementById('confirm-no-btn');
            
            // --- State Variables ---
            const ADMIN_PIN = 'memphisfoodhead'; // The 15-digit password

            // --- Admin Panel Functions ---

            // Load orders from localStorage
            const loadOrders = () => {
                const orders = JSON.parse(localStorage.getItem('foodKioskOrders')) || [];
                return orders;
            };

            // Update an order's status and save
            const updateOrderStatus = (orderId, newStatus) => {
                const orders = loadOrders();
                const orderIndex = orders.findIndex(order => order.id === orderId);
                if (orderIndex !== -1) {
                    orders[orderIndex].status = newStatus;
                    localStorage.setItem('foodKioskOrders', JSON.stringify(orders));
                    renderAdminOrders(); // Re-render to reflect changes
                }
            };
            
            // Render orders in the admin panel columns
            const renderAdminOrders = () => {
                const orders = loadOrders();
                newOrdersListAdmin.innerHTML = '';
                inProgressOrdersListAdmin.innerHTML = '';
                completedOrdersListAdmin.innerHTML = '';

                let hasNewOrders = false;
                let hasInProgressOrders = false;
                let hasCompletedOrders = false;

                orders.forEach(order => {
                    const orderDiv = document.createElement('div');
                    orderDiv.className = 'admin-order-card';
                    orderDiv.innerHTML = `
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-gray-400 text-sm">Order ID:</span>
                            <span class="text-sm font-mono text-indigo-300 break-all">${order.id}</span>
                        </div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-gray-400 text-sm">Total:</span>
                            <span class="text-green-400 font-bold">$${order.total.toFixed(2)}</span>
                        </div>
                        <div class="text-xs text-gray-500 mb-2">
                            <span>Date: ${order.timestamp}</span>
                        </div>
                        <div class="mt-2">
                            <p class="text-gray-400 text-sm">Items:</p>
                            <ul class="order-items-list">
                                ${order.items.map(item => `<li>${item.name} x ${item.quantity} ($${item.price.toFixed(2)} each)</li>`).join('')}
                            </ul>
                        </div>
                        <div class="status-buttons mt-4 flex flex-wrap gap-2">
                            ${order.status === 'new' ? 
                                `<button data-order-id="${order.id}" data-new-status="in-progress" class="btn-in-progress">
                                    <i class="fas fa-hourglass-half mr-1"></i> Start Prep
                                </button>` : ''}
                            ${order.status === 'in-progress' ? 
                                `<button data-order-id="${order.id}" data-new-status="completed" class="btn-completed">
                                    <i class="fas fa-check-circle mr-1"></i> Mark Done
                                </button>
                                <button data-order-id="${order.id}" data-new-status="new" class="btn-revert">
                                    <i class="fas fa-undo mr-1"></i> Revert
                                </button>` : ''}
                            ${order.status === 'completed' ? 
                                `<button data-order-id="${order.id}" data-new-status="in-progress" class="btn-revert">
                                    <i class="fas fa-undo mr-1"></i> Revert
                                </button>` : ''}
                        </div>
                    `;

                    if (order.status === 'new') {
                        newOrdersListAdmin.appendChild(orderDiv);
                        hasNewOrders = true;
                    } else if (order.status === 'in-progress') {
                        inProgressOrdersListAdmin.appendChild(orderDiv);
                        hasInProgressOrders = true;
                    } else if (order.status === 'completed') {
                        completedOrdersListAdmin.appendChild(orderDiv);
                        hasCompletedOrders = true;
                    }
                });

                // Display/hide "No orders" messages
                noNewOrdersMessage.style.display = hasNewOrders ? 'none' : 'block';
                noInProgressOrdersMessage.style.display = hasInProgressOrders ? 'none' : 'block';
                noCompletedOrdersMessage.style.display = hasCompletedOrders ? 'none' : 'block';

                // Attach event listeners for status change buttons
                document.querySelectorAll('.status-buttons button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const orderId = e.currentTarget.dataset.orderId;
                        const newStatus = e.currentTarget.dataset.newStatus;
                        updateOrderStatus(orderId, newStatus);
                    });
                });
            };

            // Clear all orders from localStorage (now uses custom confirmation)
            const clearAllOrders = () => {
                confirmationModal.style.display = 'flex'; // Show the confirmation modal
            };

            // Actual clear logic after confirmation
            confirmYesBtn.addEventListener('click', () => {
                localStorage.removeItem('foodKioskOrders');
                renderAdminOrders(); // Update admin view to show empty
                confirmationModal.style.display = 'none'; // Hide modal
            });

            confirmNoBtn.addEventListener('click', () => {
                confirmationModal.style.display = 'none'; // Hide modal
            });

            // Save completed orders to clipboard
            const saveCompletedOrdersToClipboard = () => {
                const orders = loadOrders();
                const completedOrders = orders.filter(order => order.status === 'completed');
                
                if (completedOrders.length === 0) {
                    alert('No completed orders to save.');
                    return;
                }

                const dataToCopy = JSON.stringify(completedOrders, null, 2); // Pretty print JSON
                const tempInput = document.createElement('textarea');
                tempInput.value = dataToCopy;
                document.body.appendChild(tempInput);
                tempInput.select();
                try {
                    document.execCommand('copy');
                    saveCompletedOrdersBtn.innerHTML = '<i class="fas fa-check mr-2"></i> Copied!';
                    setTimeout(() => {
                        saveCompletedOrdersBtn.innerHTML = '<i class="fas fa-save mr-2"></i> Save Completed Orders To Clipboard';
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy completed orders: ', err);
                    alert('Failed to copy completed orders. Please copy manually: ' + dataToCopy);
                } finally {
                    document.body.removeChild(tempInput);
                }
            };
            
            // --- Event Listeners ---
            adminLoginSubmitBtn.addEventListener('click', () => {
                if (adminPinInput.value === ADMIN_PIN) {
                    adminLoginMessage.classList.add('hidden');
                    adminLoginSubmitBtn.classList.add('hidden');
                    adminPinInput.classList.add('hidden'); // Hide input after successful login
                    adminDashboardContent.classList.remove('hidden');
                    renderAdminOrders(); // Load and display orders
                } else {
                    adminLoginMessage.classList.remove('hidden');
                }
            });

            clearOrdersBtn.addEventListener('click', clearAllOrders);
            saveCompletedOrdersBtn.addEventListener('click', saveCompletedOrdersToClipboard);

            // Initial render on page load if logged in (although we hide it, it's good practice)
            renderAdminOrders();
        });
    </script>
</body>
</html>
